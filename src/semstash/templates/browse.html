{% extends "base.html" %}
{% block title %}Browse - SemStash{% endblock %}

{% block content %}
<div class="flex justify-between items-center mb-3">
    <h1>Browse Content</h1>
    <a href="/ui/upload" class="btn btn-primary">Upload New</a>
</div>

<div class="card mb-2">
    <form method="GET" action="/ui/browse" class="flex gap-2 items-center">
        <div class="form-group" style="margin-bottom: 0; flex: 1;">
            <input type="text" class="form-control" name="prefix" value="{{ prefix }}" placeholder="Filter by prefix...">
        </div>
        <div class="form-group" style="margin-bottom: 0;">
            <select class="form-control" name="content_type">
                <option value="">All types</option>
                <option value="image" {% if content_type == 'image' %}selected{% endif %}>Images</option>
                <option value="video" {% if content_type == 'video' %}selected{% endif %}>Videos</option>
                <option value="audio" {% if content_type == 'audio' %}selected{% endif %}>Audio</option>
                <option value="text" {% if content_type == 'text' %}selected{% endif %}>Text</option>
                <option value="application/pdf" {% if content_type == 'application/pdf' %}selected{% endif %}>PDF</option>
            </select>
        </div>
        <button type="submit" class="btn btn-secondary">Filter</button>
    </form>
</div>

{% if error %}
<div class="alert alert-error">
    {{ error }}
</div>
{% elif items %}
<div class="card">
    <table>
        <thead>
            <tr>
                <th>Name</th>
                <th>Type</th>
                <th>Size</th>
                <th>Created</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for item in items %}
            <tr>
                <td>
                    <a href="/ui/content/{{ item.key }}" style="text-decoration: none; color: var(--primary);">
                        {{ item.key }}
                    </a>
                </td>
                <td class="text-muted">{{ item.content_type }}</td>
                <td class="text-muted">{{ format_size(item.file_size) }}</td>
                <td class="text-muted">{{ item.created_at.strftime('%Y-%m-%d') if item.created_at else '' }}</td>
                <td>
                    <a href="/ui/content/{{ item.key }}" class="btn btn-secondary" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;">View</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {% if next_token or prev_token %}
    <div class="pagination">
        {% if prev_token %}
        <a href="/ui/browse?prefix={{ prefix }}&content_type={{ content_type or '' }}&next_token={{ prev_token }}" class="btn btn-secondary">← Previous</a>
        {% endif %}
        {% if next_token %}
        <a href="/ui/browse?prefix={{ prefix }}&content_type={{ content_type or '' }}&next_token={{ next_token }}" class="btn btn-secondary">Next →</a>
        {% endif %}
    </div>
    {% endif %}
</div>

<p class="text-muted text-center mt-2">Showing {{ items|length }} items{% if total %} of {{ total }}{% endif %}</p>

{% else %}
<div class="card text-center">
    <p class="text-muted mb-2">No content found{% if prefix %} matching "{{ prefix }}"{% endif %}</p>
    <a href="/ui/upload" class="btn btn-primary">Upload your first file</a>
</div>
{% endif %}
{% endblock %}
