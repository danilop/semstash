{% extends "base.html" %}
{% block title %}{{ content.key }} - SemStash{% endblock %}

{% block content %}
<div class="flex justify-between items-center mb-3">
    <h1>{{ content.key }}</h1>
    <div class="flex gap-2">
        <a href="{{ content.url }}" class="btn btn-primary" target="_blank">Download</a>
        <button class="btn btn-danger" onclick="confirmDelete('{{ content.key }}')">Delete</button>
    </div>
</div>

<div class="card mb-2">
    {% if content.content_type.startswith('image/') %}
    <div class="preview-container">
        <img src="{{ content.url }}" alt="{{ content.key }}" class="preview">
    </div>
    {% elif content.content_type.startswith('video/') %}
    <div class="preview-container">
        <video src="{{ content.url }}" controls class="preview"></video>
    </div>
    {% elif content.content_type.startswith('audio/') %}
    <div class="preview-container">
        <audio src="{{ content.url }}" controls style="width: 100%;"></audio>
    </div>
    {% elif content.content_type == 'application/pdf' %}
    <div class="preview-container">
        <iframe src="{{ content.url }}" style="width: 100%; height: 600px; border: none;"></iframe>
    </div>
    {% else %}
    <div class="preview-container">
        <div class="file-icon" style="width: 100px; height: 100px; font-size: 3rem; margin: 0 auto;">
            {% if 'spreadsheet' in content.content_type %}ğŸ“Š
            {% elif 'presentation' in content.content_type %}ğŸ“½ï¸
            {% elif 'document' in content.content_type or 'word' in content.content_type %}ğŸ“
            {% elif content.content_type.startswith('text/') %}ğŸ“ƒ
            {% else %}ğŸ“{% endif %}
        </div>
        <p class="mt-2 text-muted">Preview not available for this file type</p>
    </div>
    {% endif %}
</div>

<div class="card">
    <h2 class="mb-2">Details</h2>
    <table>
        <tr>
            <td><strong>Key</strong></td>
            <td>{{ content.key }}</td>
        </tr>
        <tr>
            <td><strong>Content Type</strong></td>
            <td>{{ content.content_type }}</td>
        </tr>
        <tr>
            <td><strong>Size</strong></td>
            <td>{{ format_size(content.file_size) }}</td>
        </tr>
        <tr>
            <td><strong>Created</strong></td>
            <td>{{ content.created_at.strftime('%Y-%m-%d %H:%M:%S') if content.created_at else '' }}</td>
        </tr>
        {% if content.tags %}
        <tr>
            <td><strong>Tags</strong></td>
            <td>
                {% for tag in content.tags %}
                <span style="background: var(--gray-200); padding: 0.25rem 0.5rem; border-radius: 0.25rem; margin-right: 0.25rem;">{{ tag }}</span>
                {% endfor %}
            </td>
        </tr>
        {% endif %}
    </table>
</div>

<div class="mt-2">
    <a href="/ui/browse" class="btn btn-secondary">â† Back to Browse</a>
</div>

<!-- Delete confirmation modal -->
<div id="delete-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000;">
    <div style="background: white; max-width: 400px; margin: 20vh auto; padding: 2rem; border-radius: 0.5rem;">
        <h2 class="mb-2">Delete Content?</h2>
        <p class="mb-2">Are you sure you want to delete <strong id="delete-key"></strong>? This action cannot be undone.</p>
        <div class="flex gap-2">
            <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
            <button class="btn btn-danger" onclick="performDelete()">Delete</button>
        </div>
    </div>
</div>

<script>
let keyToDelete = '';

function confirmDelete(key) {
    keyToDelete = key;
    document.getElementById('delete-key').textContent = key;
    document.getElementById('delete-modal').style.display = 'block';
}

function closeModal() {
    document.getElementById('delete-modal').style.display = 'none';
    keyToDelete = '';
}

async function performDelete() {
    try {
        const response = await fetch('/content/' + encodeURIComponent(keyToDelete), {
            method: 'DELETE'
        });

        if (response.ok) {
            window.location.href = '/ui/browse?flash=Content deleted successfully&flash_type=success';
        } else {
            const data = await response.json();
            alert('Failed to delete: ' + (data.detail || 'Unknown error'));
        }
    } catch (err) {
        alert('Error: ' + err.message);
    }
    closeModal();
}

// Close modal on escape key
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') closeModal();
});

// Close modal on click outside
document.getElementById('delete-modal').addEventListener('click', (e) => {
    if (e.target.id === 'delete-modal') closeModal();
});
</script>
{% endblock %}
